from collections.abc import Iterable
from datetime import date
from typing import Protocol, Optional, List

from app.models import Entry, Habit


class HabitRepository(Protocol):
    def create(self, user_id: int, name: str, goal_type: str) -> Habit: ...
    def get(self, habit_id: int) -> Optional[Habit]: ...
    def list_by_user(self, user_id: int) -> List[Habit]: ...
    def exists_name(self, user_id: int, name: str) -> bool: ...
    def update(self, habit_id: int, name: Optional[str], goal_type: Optional[str]) -> Optional[Habit]: ...
    def delete(self, habit_id: int) -> bool: ...

class EntryRepository(Protocol):
    def exists_on(self, habit_id: int, d: date) -> bool: ...
    def create(self, habit_id: int, d: date, journal: Optional[str] = None) -> Entry: ...
    def dates_between(self, habit_id: int, start: date, end: date) -> Iterable[date]: ...
    def get_by_date(self, habit_id: int, d: date) -> Optional[Entry]: ...
    def update_journal(self, habit_id: int, d: date, journal: Optional[str]) -> Optional[Entry]: ...
    def list_by_habit(self, habit_id: int) -> List[Entry]: ...
